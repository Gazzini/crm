(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{1876:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return xe}});var r=n(6277),s=n(7294),i=n(266),a=n(5988),o=n(809),c=n.n(o),l=n(318),u=n(3789),d=n(8216),h=n(5997),p=n(2809),f=n(5874),v=new(n(191).y),x=n(4155),m=("localhost"===window.location.hostname?"".concat(window.location.protocol,"//").concat(window.location.hostname,":").concat(window.location.port):"".concat(window.location.protocol,"//").concat(window.location.hostname),"localhost"===window.location.hostname?x.env.NEXT_PUBLIC_API_URL:"".concat(window.location.protocol,"//").concat(window.location.hostname)),g=function(){function e(){(0,d.Z)(this,e),(0,p.Z)(this,"user",void 0),(0,p.Z)(this,"isAuthenticated",!1),(0,p.Z)(this,"error",void 0),(0,p.Z)(this,"position",void 0),(0,p.Z)(this,"systemWarning",void 0)}return(0,h.Z)(e,[{key:"login",value:function(){var e=(0,i.Z)(c().mark((function e(t){var n,r,s,i,a,o,l,u;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.username,r=t.password,e.next=3,fetch("".concat(m,"/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:n,password:r})});case 3:return s=e.sent,e.next=6,s.json();case 6:i=e.sent,a=i.token,o=i.user,l=i.message,u=i.systemWarning,a&&(this.token=a,this.user=o,this.isAuthenticated=!0,this.watchPosition()),this.error=l,this.systemWarning=u;case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"register",value:function(){var e=(0,i.Z)(c().mark((function e(t){var n,r,s,i,a,o,l,u,d;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.username,r=t.password,s=t.name,e.next=3,fetch("".concat(m,"/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:n,password:r,name:s})});case 3:return i=e.sent,e.next=6,i.json();case 6:a=e.sent,o=a.token,l=a.user,u=a.message,d=a.systemWarning,o&&(this.token=o,this.user=l,this.isAuthenticated=!0,this.watchPosition()),this.error=u,this.systemWarning=d;case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=(0,i.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.token=void 0,this.user=void 0,this.isAuthenticated=!1,this.error=void 0;case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getToken",value:function(){return this.token}},{key:"updatePosition",value:function(){var e=(0,i.Z)(c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(m,"/me"),{method:"PUT",headers:{Authorization:"Bearer ".concat(this.token),"Content-Type":"application/json"},body:JSON.stringify(this.position)});case 2:return t=e.sent,e.next=5,t.json();case 5:this.user=e.sent;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"watchPosition",value:function(){!1 in navigator?console.warn("geolocation not supported"):navigator.geolocation.watchPosition(this.geolocationSuccess.bind(this),this.geolocationError.bind(this))}},{key:"geolocationSuccess",value:function(e){var t=e.coords;this.position={lat:t.latitude,lon:t.longitude},this.updatePosition()}},{key:"geolocationError",value:function(e){console.log("geolocationError",e)}}]),e}(),j=(0,f.sj)(new g),b=n(6486),y=function(){function e(){(0,d.Z)(this,e),(0,p.Z)(this,"items",[]),(0,p.Z)(this,"bounds",void 0),(0,p.Z)(this,"center",void 0),(0,p.Z)(this,"radius",void 0),(0,p.Z)(this,"ready",!1),(0,p.Z)(this,"userCache",new Map),(0,p.Z)(this,"fetch",(0,b.throttle)(this.fetchInternal,1e3))}return(0,h.Z)(e,[{key:"setSearchBounds",value:function(e){this.bounds=e,this.fetch()}},{key:"setSearchRadius",value:function(e,t){this.center=e,this.radius=t,this.bounds=void 0,this.fetch()}},{key:"fetchInternal",value:function(){var e=(0,i.Z)(c().mark((function e(){var t,n,r,s,i,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.getToken();case 2:return n=e.sent,r=new URL("".concat(m,"/users")),null!==(t=this.bounds)&&void 0!==t&&t.sw&&(r.searchParams.append("sw.lat",this.bounds.sw.lat),r.searchParams.append("sw.lon",this.bounds.sw.lon),r.searchParams.append("ne.lat",this.bounds.ne.lat),r.searchParams.append("ne.lon",this.bounds.ne.lon)),this.center&&(r.searchParams.append("center.lat",this.center.lat),r.searchParams.append("center.lon",this.center.lon),r.searchParams.append("radius",this.radius)),e.next=8,fetch(r,{headers:{Authorization:"Bearer ".concat(n)}});case 8:return s=e.sent,e.next=11,s.json();case 11:i=e.sent,a=i.items,this.items=(a||[]).filter((function(e){return e.value.id!==j.user.id})),this.ready=!0;case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getUser",value:function(){var e=(0,i.Z)(c().mark((function e(t){var n,r,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.userCache.get(t)){e.next=11;break}return e.next=3,j.getToken();case 3:return n=e.sent,e.next=6,fetch("".concat(m,"/users/").concat(t),{headers:{Authorization:"Bearer ".concat(n)}});case 6:return r=e.sent,e.next=9,r.json();case 9:s=e.sent,this.userCache.set(t,s);case 11:return e.abrupt("return",this.userCache.get(t));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),w=(0,f.sj)(new y),k=function(){function e(){(0,d.Z)(this,e),(0,p.Z)(this,"messages",[]),(0,p.Z)(this,"conversations",[]),(0,p.Z)(this,"typing",!1),(0,p.Z)(this,"message",""),(0,p.Z)(this,"selectedConversation",void 0),(0,p.Z)(this,"selectedConversationId",void 0),(0,p.Z)(this,"selectedUserId",void 0),(0,p.Z)(this,"typingConversationId",void 0),(0,p.Z)(this,"typingTimeout",void 0)}return(0,h.Z)(e,[{key:"selectConversation",value:function(e){var t=e.convId;t!==this.selectedConversationId&&(this.messages=[],this.selectedConversationId=t,this.selectedConversation=this.conversations.find((function(e){return e.value.convId===t})),this.selectedUserId=void 0,this.selectedUserName=void 0,this.conversations=this.conversations.filter((function(e){return"new-conversation"!==e.value.convId})),this.fetch()),v.emit("conversation.selected",[this.selectedConversationId])}},{key:"findUserConversation",value:function(){var e=(0,i.Z)(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.conversations.find((function(e){var n;return null===(n=e.value.userIds)||void 0===n?void 0:n.includes(t)})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"selectUser",value:function(){var e=(0,i.Z)(c().mark((function e(t){var n,r,s,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,r=t.name,e.next=3,this.findUserConversation(n);case 3:if(!(s=e.sent)){e.next=7;break}return this.selectConversation(s.value),e.abrupt("return");case 7:this.selectedConversationId="new-conversation",this.selectedConversation={key:"new-conversation",value:{title:r,convId:"new-conversation",last:"New conversation"}},this.selectedUserId=n,this.selectedUserName=r,this.messages=[],i=this.conversations.filter((function(e){return"new-conversation"!==e.value.convId})),this.conversations=[this.selectedConversation].concat((0,u.Z)(i)),v.emit("conversation.selected",[this.selectedConversationId]);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"start",value:function(){var e=this;return this.interval||(this.interval=setInterval(this.fetch.bind(this),5e3),this.fetch()),function(){e.stop()}}},{key:"stop",value:function(){this.interval&&(clearInterval(this.interval),this.interval=void 0)}},{key:"updateTyping",value:function(){var e=(0,i.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.typingTimeout&&clearTimeout(this.typingTimeout),!this.typingConversationId||this.typingConversationId===this.selectedConversationId){e.next=5;break}return e.next=4,this.putTypingState(this.typingConversationId,!1);case 4:this.typingConversationId=void 0;case 5:if(!this.selectedConversationId||"new-conversation"===this.selectedConversationId||this.typingConversationId){e.next=9;break}return this.typingConversationId=this.selectedConversationId,e.next=9,this.putTypingState(this.typingConversationId,!0);case 9:this.typingTimeout=setTimeout(this.clearTyping.bind(this),5e3);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"clearTyping",value:function(){var e=(0,i.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.putTypingState(this.typingConversationId,!1);case 2:this.typingConversationId=void 0;case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"putTypingState",value:function(){var e=(0,i.Z)(c().mark((function e(t,n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.getToken();case 2:return r=e.sent,e.next=5,fetch("".concat(m,"/typing"),{method:"PUT",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"},body:JSON.stringify({convId:t,typing:n})});case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getConversations",value:function(){var e=(0,i.Z)(c().mark((function e(){var t,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.getToken();case 2:return t=e.sent,e.next=5,fetch("".concat(m,"/conversations"),{headers:{Authorization:"Bearer ".concat(t)}});case 5:return n=e.sent,e.abrupt("return",n.json());case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getMessages",value:function(){var e=(0,i.Z)(c().mark((function e(t){var n,r,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&"new-conversation"!==t){e.next=2;break}return e.abrupt("return",{items:[]});case 2:return e.next=4,j.getToken();case 4:return n=e.sent,(r=new URL("".concat(m,"/messages"))).searchParams.append("convId",t),e.next=9,fetch(r,{headers:{Authorization:"Bearer ".concat(n)}});case 9:return s=e.sent,e.abrupt("return",s.json());case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetch",value:function(){var e=(0,i.Z)(c().mark((function e(){var t,n,r,s,i,a=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=this.selectedConversationId)||(this.messages=[]),e.next=4,Promise.all([this.getMessages(t),this.getConversations()]);case 4:if(n=e.sent,r=(0,l.Z)(n,2),s=r[0],i=r[1],this.messages=s.items,this.conversations=i.items,this.selectedConversation=this.selectedConversationId&&this.conversations.find((function(e){return e.value.convId===a.selectedConversationId})),this.selectedUserId&&(this.selectedConversationId="new-conversation",this.selectedConversation={key:"new-conversation",value:{title:this.selectedUserName,convId:"new-conversation",last:"New conversation"}},this.conversations=[this.selectedConversation].concat((0,u.Z)(this.conversations))),this.selectedUserId||this.selectedConversationId||!this.conversations[0]){e.next=16;break}return this.selectedConversationId=this.conversations[0].value.convId,e.next=16,this.fetch();case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createConversation",value:function(){var e=(0,i.Z)(c().mark((function e(){var t,n,r,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.getToken();case 2:return t=e.sent,e.next=5,fetch("".concat(m,"/conversations"),{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({userIds:[this.selectedUserId,j.user.id]})});case 5:return n=e.sent,e.next=8,n.json();case 8:return r=e.sent,s=r.convId,e.abrupt("return",s);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=(0,i.Z)(c().mark((function e(){var t,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.message){e.next=2;break}return e.abrupt("return");case 2:if(t=this.message,this.message="","new-conversation"!==this.selectedConversationId){e.next=8;break}return e.next=7,this.createConversation();case 7:this.selectedConversationId=e.sent;case 8:return e.next=10,j.getToken();case 10:return n=e.sent,e.next=13,fetch("".concat(m,"/messages"),{method:"POST",headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"},body:JSON.stringify({convId:this.selectedConversationId,text:t})});case 13:return this.selectedUserId=void 0,e.next=16,Promise.all([this.fetch(),this.clearTyping()]);case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getUsers",value:function(){var e=(0,i.Z)(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map((function(e){return w.getUser(e)})));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),C=(0,f.sj)(new k),Z=n(5893);function N(){return(0,Z.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"6",viewBox:"0 0 24 6",children:(0,Z.jsxs)("g",{className:"jsx-728468970",children:[(0,Z.jsx)(a.default,{id:"728468970",children:[".dot.jsx-728468970{fill:rgba(0,0,0,0.7);-webkit-transform-origin:50% 50%;-ms-transform-origin:50% 50%;transform-origin:50% 50%;-webkit-animation:ball-beat-jsx-728468970 1.1s 0s infinite cubic-bezier(0.445,0.05,0.55,0.95);animation:ball-beat-jsx-728468970 1.1s 0s infinite cubic-bezier(0.445,0.05,0.55,0.95);}",".dot.jsx-728468970:nth-child(2){-webkit-animation-delay:0.3s !important;animation-delay:0.3s !important;}",".dot.jsx-728468970:nth-child(3){-webkit-animation-delay:0.6s !important;animation-delay:0.6s !important;}","@-webkit-keyframes ball-beat-jsx-728468970{0%{opacity:0.7;}33.33%{opacity:0.55;}66.67%{opacity:0.4;}100%{opacity:1;}}","@keyframes ball-beat-jsx-728468970{0%{opacity:0.7;}33.33%{opacity:0.55;}66.67%{opacity:0.4;}100%{opacity:1;}}"]}),(0,Z.jsx)("circle",{cx:"3",cy:"3",r:"3",className:"jsx-728468970 dot"}),(0,Z.jsx)("circle",{cx:"12",cy:"3",r:"3",className:"jsx-728468970 dot"}),(0,Z.jsx)("circle",{cx:"21",cy:"3",r:"3",className:"jsx-728468970 dot"})]})})}function I(){return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(a.default,{id:"2229286083",children:["p.jsx-2229286083{max-width:66%;word-wrap:break-word;line-height:24px;position:relative;padding:10px 20px;border-radius:25px;margin:5px;}",'p.jsx-2229286083:before{width:20px;content:"";position:absolute;bottom:0;height:25px;}','p.jsx-2229286083:after{width:26px;content:"";position:absolute;bottom:0;height:25px;}',".receive.jsx-2229286083:before{left:-7px;border-bottom-right-radius:16px 14px;background-color:#f8f9fa;}",".receive.jsx-2229286083:after{left:-26px;background-color:#fff;border-bottom-right-radius:10px;}"]}),(0,Z.jsx)("li",{className:"jsx-2229286083 d-flex align-items-center mb-2",children:(0,Z.jsx)("p",{className:"jsx-2229286083 bg-light receive",children:(0,Z.jsx)(N,{})})})]})}function P(e){var t=e.typing,n=(0,r.RK)(C).message,o=(0,s.useRef)(),l=(0,s.useCallback)((function(e){(0,i.Z)(c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.preventDefault(),e.stopPropagation(),C.send();case 3:case"end":return t.stop()}}),t)})))()}),[]),u=(0,s.useCallback)((function(){setTimeout((function(){return o.current.focus()}),100)}),[]),d=(0,s.useCallback)((function(e){C.message=e.target.value,C.updateTyping()}),[]);return(0,s.useEffect)((function(){return v.on("conversation.selected",u),function(){v.off("conversation.selected",u)}}),[u]),(0,Z.jsxs)("form",{onSubmit:l,className:"jsx-1609445409 position-absolute bottom-0 w-100",children:[(0,Z.jsx)(a.default,{id:"1609445409",children:["*.jsx-1609445409{background-color:rgba(255,255,255,0.6);}"]}),(0,Z.jsxs)("div",{className:"jsx-1609445409 p-2",children:[t&&(0,Z.jsx)(I,{}),(0,Z.jsx)("input",{ref:o,type:"text",value:n,placeholder:"Message",onChange:d,className:"jsx-1609445409 text-muted rounded-pill form-control"})]})]})}var O=n(6010);function T(e){var t=e.message,n=e.sent;return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(a.default,{id:"3677243528",children:["p.jsx-3677243528{max-width:66%;word-wrap:break-word;line-height:24px;position:relative;padding:10px 20px;border-radius:25px;margin:5px;}",'p.jsx-3677243528:before{width:20px;content:"";position:absolute;bottom:0;height:25px;}','p.jsx-3677243528:after{width:26px;content:"";position:absolute;bottom:0;height:25px;}',".send.jsx-3677243528:before{right:-7px;border-bottom-left-radius:16px 14px;background-color:#0d6efd;}",".send.jsx-3677243528:after{right:-26px;border-bottom-left-radius:10px;background-color:#fff;}",".receive.jsx-3677243528:before{left:-7px;border-bottom-right-radius:16px 14px;background-color:#f8f9fa;}",".receive.jsx-3677243528:after{left:-26px;background-color:#fff;border-bottom-right-radius:10px;}"]}),(0,Z.jsx)("li",{className:"jsx-3677243528 "+((0,O.Z)("d-flex align-items-center overflow-hidden",n&&"flex-row-reverse")||""),children:(0,Z.jsx)("p",{className:"jsx-3677243528 "+((0,O.Z)(n?"bg-primary text-white send":"bg-light receive")||""),children:t.value.text})})]})}function S(e){var t=e.className,n=(0,r.RK)(C).messages,i=(0,r.RK)(j),o=(0,s.useRef)();return(0,s.useEffect)((function(){o.current.scrollTop=o.current.scrollHeight-o.current.clientHeight}),[n]),(0,Z.jsxs)("ul",{ref:o,className:"jsx-363670536 "+((0,O.Z)("list-unstyled p-3 mb-0",t)||""),children:[(0,Z.jsx)(a.default,{id:"363670536",children:["ul.jsx-363670536{overflow-y:scroll;overflow-x:hidden;padding-bottom:4em !important;}","ul.jsx-363670536::-webkit-scrollbar-track{display:none;}"]}),n.map((function(e,t){return(0,Z.jsx)(T,{message:e,sent:i.user.id===e.value.from},t)}))]})}var U=n(2224),R=n(682),z=n(4209),E=n(5093);function A(e){var t=e.src,n=e.alt;return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(a.default,{id:"2171769601",children:["img.jsx-2171769601{width:50px;height:50px;border-radius:10px;}"]}),(0,Z.jsx)("img",{src:t,alt:n,className:"jsx-2171769601"})]})}function B(){return(0,Z.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"currentColor",viewBox:"0 0 16 16",children:(0,Z.jsx)("path",{fillRule:"evenodd",d:"M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"})})}var _=(0,f.sj)(new function e(){(0,d.Z)(this,e),(0,p.Z)(this,"current","search")});function K(){(0,r.RK)(j).user;var e=(0,r.RK)(C).selectedConversation,t=null===e||void 0===e?void 0:e.value.title,n=null===e||void 0===e?void 0:e.value.picture;return(0,Z.jsx)(U.Z,{className:"border-bottom",children:(0,Z.jsxs)(R.Z,{fluid:!0,children:[(0,Z.jsx)(z.Z,{className:"d-md-none text-primary",children:(0,Z.jsx)(z.Z.Link,{className:"text-primary",onClick:function(){return _.current="search"},children:(0,Z.jsx)(B,{})})}),(0,Z.jsxs)(U.Z.Text,{className:"flex-grow-1 text-center d-flex flex-column align-items-center gap-2",children:[n&&(0,Z.jsx)(A,{src:n,alt:t}),(0,Z.jsx)("div",{children:t})]}),(0,Z.jsx)(z.Z,{children:(0,Z.jsx)(E.Z,{align:"end",children:(0,Z.jsx)(E.Z.Item,{onClick:function(){return j.logout()},children:"Logout"})})})]})})}function F(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?F(Object(n),!0).forEach((function(t){(0,p.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function M(e){var t=e.picture,n=e.title,r=e.last,s=e.selected,i=e.onClick,a=e.typing;return(0,Z.jsx)("div",{className:(0,O.Z)("list-group-item list-group-item-action bg-white border-0 py-1 px-0"),children:(0,Z.jsxs)("a",{href:"#",className:(0,O.Z)("list-group-item list-group-item-action bg-gray-200 border-0 rounded-3 mx-0 d-flex gap-3 align-items-center",s&&"active"),onClick:i,children:[(0,Z.jsx)("div",{children:t&&(0,Z.jsx)(A,{src:t,alt:n})}),(0,Z.jsxs)("div",{children:[(0,Z.jsx)("h1",{className:"fs-5 mb-1",children:n}),(0,Z.jsx)("p",{className:(0,O.Z)(s?"text-light":"text-black-50","fs-6 mt-0 mb-1"),children:a?(0,Z.jsx)(N,{}):r})]})]})})}function D(){return(0,Z.jsx)("p",{className:"text-center m-4 text-black-50",children:"No conversations found, try searching for users nearby"})}function W(){var e=(0,r.RK)(C),t=e.conversations,n=e.selectedConversationId,i=(0,s.useCallback)((function(e){C.selectConversation(e)}),[]);return(0,Z.jsxs)("div",{children:[0===t.length&&(0,Z.jsx)(D,{}),(0,Z.jsx)("ul",{className:"list-group rounded-0",children:t.map((function(e){var t=e.key,r=e.value;return(0,Z.jsx)(M,L(L({},r),{},{selected:r.convId===n,onClick:function(){return i(r)}}),t)}))})]})}var J=n(3839);function X(){return(0,Z.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",fill:"currentColor",viewBox:"0 0 16 16",children:(0,Z.jsx)("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"})})}function H(){return(0,Z.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",fill:"currentColor",viewBox:"0 0 16 16",children:(0,Z.jsx)("path",{d:"M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"})})}var G=function(){};function q(e){var t=e.value,n=e.onChange,r=void 0===n?G:n,i=e.searching,o=e.onSearchingChange,c=void 0===o?G:o,l=(0,s.useCallback)((function(){i||c(!0)}),[c,i]),u=(0,s.useCallback)((function(){r(""),c(!1)}),[r,c]),d=(0,s.useCallback)((function(e){r(e.target.value)}),[r]);return(0,Z.jsxs)(J.Z,{children:[(0,Z.jsx)(a.default,{id:"1210274151",children:[".close.jsx-1210274151{position:absolute;right:0.45rem;top:0.25rem;z-index:1000;}",".search.jsx-1210274151{position:absolute;z-index:1000;left:0.45rem;top:0.25rem;}",".input.jsx-1210274151{padding-left:2rem;}"]}),(0,Z.jsx)("span",{className:"jsx-1210274151 search text-secondary",children:(0,Z.jsx)(X,{})}),(0,Z.jsx)("input",{placeholder:"Search",onFocus:l,value:t,onChange:d,className:"jsx-1210274151 form-control rounded-3 input"}),i&&(0,Z.jsx)("span",{className:"jsx-1210274151 close",children:(0,Z.jsx)("button",{onClick:u,className:"jsx-1210274151 bg-white border-0 text-secondary",children:(0,Z.jsx)(H,{})})})]})}function Q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(n),!0).forEach((function(t){(0,p.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Y=function(){};function $(e){var t=e.picture,n=e.name,r=e.onClick;return(0,Z.jsxs)("a",{href:"#",className:(0,O.Z)("list-group-item list-group-item-action bg-gray-200 border-0 px-0 py-1 d-flex align-items-center gap-3"),onClick:r,children:[t&&(0,Z.jsx)(A,{src:t,alt:n}),(0,Z.jsx)("h1",{className:"fs-5 mb-1",children:n})]})}function ee(e){var t=e.title,n=e.picture,r=e.last,s=e.selected,i=e.onClick;return(0,Z.jsxs)("a",{href:"#",className:(0,O.Z)("list-group-item list-group-item-action bg-gray-200 border-0 px-0 d-flex gap-3 align-items-center",s&&"active"),onClick:i,children:[n&&(0,Z.jsx)(A,{src:n,alt:t}),(0,Z.jsxs)("div",{children:[(0,Z.jsx)("h1",{className:"fs-5 mb-1",children:t}),(0,Z.jsx)("p",{className:(0,O.Z)(s?"text-light":"text-black-50","fs-6 mt-0 mb-1"),children:r})]})]})}function te(){return(0,Z.jsx)("p",{children:"No users found, try zooming out or panning to a different area"})}function ne(e){var t=e.onConversationClick,n=void 0===t?Y:t,s=e.onUserClick,i=void 0===s?Y:s,a=(0,r.RK)(C).conversations,o=(0,r.RK)(w),c=o.items,l=o.ready;return(0,Z.jsxs)("div",{className:"p-2",children:[a.length>0&&(0,Z.jsxs)("div",{className:"p-0 pt-4",children:[(0,Z.jsx)("h4",{children:"Conversations"}),(0,Z.jsx)("ul",{className:"list-group rounded-0",children:a.map((function(e){var t=e.key,r=e.value;return(0,Z.jsx)(ee,V(V({},r),{},{onClick:function(){return n(r)}}),t)}))})]}),(0,Z.jsxs)("div",{className:"p-0 pt-4",children:[(0,Z.jsx)("h4",{children:"Users nearby"}),l&&(0,Z.jsxs)(Z.Fragment,{children:[0===c.length&&(0,Z.jsx)(te,{}),c.length>0&&(0,Z.jsx)("ul",{className:"list-group",children:c.map((function(e){var t=e.key,n=e.value;return(0,Z.jsx)($,V(V({},n),{},{onClick:function(){return i(n)}}),t)}))})]})]})]})}var re=(0,n(5152).default)((function(){return Promise.all([n.e(269),n.e(148)]).then(n.bind(n,4148))}),{ssr:!1,loadableGenerated:{webpack:function(){return[4148]},modules:["../components/UserMap.js -> @components/Map"]}});function se(){var e=(0,r.RK)(w).items,t=(0,r.RK)(j).user,n=e.filter((function(e){return e.value.lat})).map((function(e){var t=e.key,n=e.value;return{key:t,lat:n.lat,lon:n.lon,text:n.name}})),i=(0,s.useCallback)((function(e){w.setSearchBounds(e)}),[]);return t.lat?(0,Z.jsx)(re,{zoom:10,markers:n,height:200,lat:t.lat,lon:t.lon,onBoundsChange:i}):null}function ie(){var e=(0,s.useState)(""),t=e[0],n=e[1],r=(0,s.useState)(!0),i=r[0],a=r[1],o=(0,s.useCallback)((function(e){n(e)}),[]),c=(0,s.useCallback)((function(e){a(e)}),[]),l=(0,s.useCallback)((function(e){C.selectConversation(e),a(!1),n("")}),[]),u=(0,s.useCallback)((function(e){C.selectUser(e),a(!1),n("")}),[]);return(0,Z.jsxs)("div",{className:"p-2",children:[(0,Z.jsx)(q,{value:t,onChange:o,searching:i,onSearchingChange:c}),i&&(0,Z.jsxs)("div",{className:"mt-2",children:[(0,Z.jsx)(se,{}),(0,Z.jsx)(ne,{onConversationClick:l,onUserClick:u})]}),!i&&(0,Z.jsx)(W,{})]})}var ae=n(1555);function oe(e){var t=e.children,n=e.className,r=e.selected;return(0,Z.jsx)(ae.Z,{className:(0,O.Z)("px-0 overflow-hidden position-relative d-md-block h-100",!r&&"d-none",n),children:t})}function ce(e){var t=e.children,n=e.selected;return(0,Z.jsx)(ae.Z,{className:(0,O.Z)("p-0 col-md-4 border-end d-md-block",!n&&"d-none"),sm:12,children:t})}var le=n(4051),ue=n(6409);function de(e){var t=e.children;return(0,Z.jsx)(ue.ZP,{children:(0,Z.jsx)(R.Z,{fluid:!0,className:"h-100",children:(0,Z.jsx)(le.Z,{className:"h-100",children:t})})})}function he(){(0,s.useEffect)((function(){return C.start()}),[]);var e=(0,r.RK)(_),t=(0,r.RK)(C).selectedConversation,n=(0,s.useCallback)((function(){_.current="conversation"}),[]);return(0,s.useEffect)((function(){return v.on("conversation.selected",n),function(){v.off("conversation.selected",n)}}),[n]),(0,Z.jsxs)(de,{children:[(0,Z.jsx)(ce,{selected:"search"===e.current,children:(0,Z.jsx)(ie,{})}),(0,Z.jsxs)(oe,{className:"d-flex flex-column",selected:"search"!==e.current,children:[(0,Z.jsx)(K,{}),(0,Z.jsx)(S,{className:"flex-grow-1"}),(0,Z.jsx)(P,{typing:null===t||void 0===t?void 0:t.value.typing})]})]})}var pe=n(5005);function fe(){var e,t=(0,s.useState)(""),n=t[0],i=t[1],a=(0,s.useState)(""),o=a[0],c=a[1],l=(0,s.useState)(""),u=l[0],d=l[1],h=(0,s.useState)(!1),f=h[0],v=h[1],x=(0,r.RK)(j);return(0,Z.jsx)("div",{className:"d-flex vh-100 align-items-center",children:(0,Z.jsxs)("div",{className:"d-flex vw-100 flex-column align-items-center gap-5",children:[(0,Z.jsx)("h1",{children:"Welcome to CloudChat"}),(0,Z.jsxs)("form",{children:[x.error&&(0,Z.jsx)("div",{className:"alert alert-primary",role:"alert",children:x.error}),f&&(0,Z.jsxs)("div",{className:"mb-3",children:[(0,Z.jsx)("label",{htmlFor:"name",className:"form-label",children:"Full name"}),(0,Z.jsx)("input",{id:"name",type:"text",name:"name",className:"form-control",value:u,onChange:function(e){return d(e.target.value)}})]}),(0,Z.jsxs)("div",{className:"mb-3",children:[(0,Z.jsx)("label",{htmlFor:"username",className:"form-label",children:"Username"}),(0,Z.jsx)("input",{id:"username",type:"text",name:"username",className:"form-control",value:n,onChange:function(e){return i(e.target.value)}})]}),(0,Z.jsxs)("div",{className:"mb-3",children:[(0,Z.jsx)("label",{htmlFor:"password",className:"form-label",children:"Password"}),(0,Z.jsx)("input",(e={type:"password",className:"form-control",id:"exampleInputPassword1"},(0,p.Z)(e,"type","password"),(0,p.Z)(e,"name","password"),(0,p.Z)(e,"value",o),(0,p.Z)(e,"onChange",(function(e){return c(e.target.value)})),e))]}),!f&&(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)("div",{children:(0,Z.jsx)(pe.Z,{onClick:function(){return j.login({username:n,password:o})},children:"Sign in"})}),(0,Z.jsx)("div",{children:(0,Z.jsx)("button",{type:"button",className:"btn btn-link mt-3 ps-0",onClick:function(){return v(!0)},children:"No account yet? Click here to register"})})]}),f&&(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)("div",{children:(0,Z.jsx)(pe.Z,{onClick:function(){return j.register({username:n,name:u,password:o})},children:"Register"})}),(0,Z.jsx)("div",{children:(0,Z.jsx)("button",{type:"button",className:"btn btn-link mt-3 ps-0",onClick:function(){return v(!1)},children:"Already have an account? Click here to sign in"})})]})]}),(0,Z.jsx)("p",{children:"Powered by Serverless \u26a1\ufe0f Cloud"})]})})}function ve(e){var t=e.message;return(0,Z.jsx)("div",{className:"alert alert-primary",role:"alert",children:t})}function xe(){var e=(0,r.RK)(j);return(0,Z.jsxs)(Z.Fragment,{children:[e.systemWarning&&(0,Z.jsx)(ve,{message:e.systemWarning}),e.isAuthenticated?(0,Z.jsx)(he,{}):(0,Z.jsx)(fe,{})]})}},8581:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(1876)}])}},function(e){e.O(0,[774,662,535,888,179],(function(){return t=8581,e(e.s=t);var t}));var t=e.O();_N_E=t}]);